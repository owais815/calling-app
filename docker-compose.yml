version: '3'

services:
    mirotalksfu:
        build:
            context: .
            dockerfile: Dockerfile
        container_name: mirotalksfu
        hostname: mirotalksfu
        restart: unless-stopped
        environment:
            # Set this to your VPS public IP — required for WebRTC ICE candidates
            - MEDIASOUP_ANNOUNCED_IP=${MEDIASOUP_ANNOUNCED_IP}
            # LMS shared secret — must match backend CALLING_APP_API_SECRET
            - CALLING_APP_API_SECRET=${CALLING_APP_API_SECRET:-lms_calling_secret_2026}
            - PORT=3010
        volumes:
            - ./app/src/config.js:/src/app/src/config.js:ro
        ports:
            # HTTP — nginx on the host will proxy this to HTTPS
            - '127.0.0.1:3010:3010/tcp'
            # WebRTC media ports — must be open in firewall
            - '40000-40100:40000-40100/udp'
            - '40000-40100:40000-40100/tcp'
        network_mode: bridge
